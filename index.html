<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bora Transportes - Controle de Estoque</title>

<style>
:root {
  --cor-primaria: #002855;
  --cor-secundaria: #ffffff;
  --cor-fundo: #f4f4f9;
  --cor-alerta: #dc3545;
  --cor-terciaria: #6c757d;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:sans-serif;background:var(--cor-fundo);color:#333;display:flex;flex-direction:column;align-items:center;min-height:100vh;padding-top:60px;}
.main-header{width:100%;background:var(--cor-primaria);color:var(--cor-secundaria);text-align:center;padding:20px 0;position:fixed;top:0;left:0;z-index:100;box-shadow:0 2px 6px rgba(0,0,0,0.2);}
.screen{background:var(--cor-secundaria);padding:40px;border-radius:8px;box-shadow:0 4px 10px rgba(0,0,0,0.1);width:90%;max-width:900px;margin-top:100px;margin-bottom:40px;display:none;}
.screen.active{display:block;}
.sub-title{text-align:center;color:var(--cor-primaria);margin-bottom:25px;}
.button-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;}
.main-button{background:var(--cor-primaria);color:var(--cor-secundaria);border:none;padding:25px 15px;font-size:1.2em;font-weight:bold;border-radius:6px;cursor:pointer;transition:.3s;}
.main-button:hover{background:#003366;}
iframe{border:none;width:100%;height:800px;border-radius:8px;overflow:hidden;}
.forms-wrap{border:2px solid #002855;border-radius:8px;overflow:hidden;}
.btn-flutuante{position:fixed;bottom:30px;right:30px;background:var(--cor-primaria);color:white;border:none;padding:15px 25px;border-radius:50px;font-weight:bold;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,0.25);transition:0.3s;z-index:999;}
.btn-flutuante:hover{background:#003366;}
.saldo-input{width:100%;padding:15px;border:2px solid var(--cor-primaria);border-radius:8px;font-size:1.1em;margin-bottom:20px;transition:.3s;}
.saldo-input:focus{outline:none;box-shadow:0 0 5px var(--cor-primaria);}
.resultado-saldo{background:#f8f9fa;border-left:5px solid var(--cor-primaria);padding:20px;border-radius:8px;}
</style>
</head>

<body>
<header class="main-header"><h1>Sistema de Gest√£o de Estoque</h1></header>

<!-- MENU PRINCIPAL -->
<main id="tela-principal" class="screen active">
  <h2 class="sub-title">Selecione uma Op√ß√£o</h2>
  <div class="button-grid">
    <button id="btn-cadastro" class="main-button">Cadastro</button>
    <button id="btn-entrada" class="main-button">Entrada</button>
    <button id="btn-saida" class="main-button">Sa√≠da</button>
    <button id="btn-saldo" class="main-button">Saldo</button>
  </div>
</main>

<!-- CADASTRO -->
<div id="tela-cadastro" class="screen">
  <h2 class="sub-title">Cadastro de Produto</h2>
  <div class="forms-wrap">
    <iframe src="https://forms.office.com/Pages/ResponsePage.aspx?id=V2vtxCDuGECFbJBsQgFoSMHt4qeT3V1Djd4VrtFsitxURTRUMlpWNDQ2VTJJWUM0T05BTkVGRUdDRy4u&embed=true" allowfullscreen></iframe>
  </div>
  <button id="btn-voltar-cadastro" class="btn-flutuante">‚Üê Voltar</button>
</div>

<!-- ENTRADA -->
<div id="tela-entrada" class="screen">
  <h2 class="sub-title">Registro de Entrada</h2>
  <div class="forms-wrap">
    <iframe src="https://forms.office.com/Pages/ResponsePage.aspx?id=V2vtxCDuGECFbJBsQgFoSMHt4qeT3V1Djd4VrtFsitxUODg1NjJLTEYzOFRaVjlGMFEwWDJVSEVWWi4u&embed=true" allowfullscreen></iframe>
  </div>
  <button id="btn-voltar-entrada" class="btn-flutuante">‚Üê Voltar</button>
</div>

<!-- SA√çDA -->
<div id="tela-saida" class="screen">
  <h2 class="sub-title">Registro de Sa√≠da</h2>
  <div class="forms-wrap">
    <iframe src="https://forms.office.com/Pages/ResponsePage.aspx?id=V2vtxCDuGECFbJBsQgFoSMHt4qeT3V1Djd4VrtFsitxUMEg4TTdMVVJaUktJTlpPR1NCQjBITllISS4u&embed=true" allowfullscreen></iframe>
  </div>
  <button id="btn-voltar-saida" class="btn-flutuante">‚Üê Voltar</button>
</div>

<!-- SALDO -->
<div id="tela-saldo" class="screen">
  <h2 class="sub-title">Consulta de Saldo</h2>
  <input type="text" id="campo-busca" class="saldo-input" placeholder="üîç Digite o c√≥digo de f√°brica ou descri√ß√£o do produto...">
  <div id="resultado-saldo" class="resultado-saldo">
    <p><strong>Produto:</strong> ‚Äî</p>
    <p><strong>C√≥digo de F√°brica:</strong> ‚Äî</p>
    <p><strong>Saldo Atual:</strong> ‚Äî</p>
  </div>
  <button id="btn-voltar-saldo" class="btn-flutuante">‚Üê Voltar</button>
</div>

<script>
// ======== TROCA DE TELAS ======== //
document.addEventListener("DOMContentLoaded", () => {
  const telas = document.querySelectorAll(".screen");
  const mostrarTela = id => {
    telas.forEach(t => t.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    window.scrollTo(0,0);
  };
  document.getElementById("btn-cadastro").onclick = () => mostrarTela("tela-cadastro");
  document.getElementById("btn-entrada").onclick = () => mostrarTela("tela-entrada");
  document.getElementById("btn-saida").onclick = () => mostrarTela("tela-saida");
  document.getElementById("btn-saldo").onclick = () => mostrarTela("tela-saldo");
  document.getElementById("btn-voltar-cadastro").onclick = () => mostrarTela("tela-principal");
  document.getElementById("btn-voltar-entrada").onclick = () => mostrarTela("tela-principal");
  document.getElementById("btn-voltar-saida").onclick = () => mostrarTela("tela-principal");
  document.getElementById("btn-voltar-saldo").onclick = () => mostrarTela("tela-principal");

  // ======== CONSULTA DE SALDO (SharePoint) ======== //
  const campoBusca = document.getElementById("campo-busca");
  const resultado = document.getElementById("resultado-saldo");
  campoBusca.addEventListener("input", async () => {
    const termo = campoBusca.value.trim();
    if (termo.length < 2) return;
    try {
      const produtos = await fetch("/api/sharepoint?lista=Produtos&filtro=" + encodeURIComponent(termo)).then(r=>r.json());
      const entradas = await fetch("/api/sharepoint?lista=Entrada&filtro=" + encodeURIComponent(termo)).then(r=>r.json());
      const saidas = await fetch("/api/sharepoint?lista=Saidas&filtro=" + encodeURIComponent(termo)).then(r=>r.json());

      if (!produtos.length) {
        resultado.innerHTML = "<p>‚ùå Produto n√£o encontrado.</p>";
        return;
      }
      const produto = produtos[0];
      const totalEntradas = entradas.reduce((s,e)=>s+Number(e.Quantidade||0),0);
      const totalSaidas = saidas.reduce((s,e)=>s+Number(e.Quantidade||0),0);
      const saldo = totalEntradas - totalSaidas;

      resultado.innerHTML = `
        <p><strong>Produto:</strong> ${produto.DescricaoProduto || "‚Äî"}</p>
        <p><strong>C√≥digo de F√°brica:</strong> ${produto.Title || "‚Äî"}</p>
        <p><strong>Saldo Atual:</strong> ${saldo} ${produto.UnidadeMedida || ""}</p>
      `;
    } catch(err){
      resultado.innerHTML = "<p>‚ö†Ô∏è Erro ao buscar saldo.</p>";
    }
  });
});
</script>
</body>
</html>
