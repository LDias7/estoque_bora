<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bora Transportes - Controle de Estoque</title>

<style>
:root {
  --cor-primaria: #002855;
  --cor-secundaria: #ffffff;
  --cor-fundo: #f4f4f9;
  --cor-alerta: #dc3545;
  --cor-terciaria: #6c757d;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:sans-serif;background:var(--cor-fundo);color:#333;display:flex;flex-direction:column;align-items:center;min-height:100vh;padding-top:60px;}
.main-header{width:100%;background:var(--cor-primaria);color:var(--cor-secundaria);text-align:center;padding:20px 0;position:fixed;top:0;left:0;z-index:100;box-shadow:0 2px 6px rgba(0,0,0,0.2);}
.screen{background:var(--cor-secundaria);padding:40px;border-radius:8px;box-shadow:0 4px 10px rgba(0,0,0,0.1);width:90%;max-width:900px;margin-top:100px;margin-bottom:40px;display:none;position:relative;}
.screen.active{display:block;}
.sub-title{text-align:center;color:var(--cor-primaria);margin-bottom:25px;}
.button-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;}
.main-button{background:var(--cor-primaria);color:var(--cor-secundaria);border:none;padding:25px 15px;font-size:1.2em;font-weight:bold;border-radius:6px;cursor:pointer;transition:.3s;}
.main-button:hover{background:#003366;}
.data-display{background:#f8f9fa;border:1px solid #dee2e6;padding:15px;border-radius:4px;margin-bottom:20px;border-left:5px solid var(--cor-primaria);}
.large-text{font-size:1.6em;font-weight:bold;}
iframe{
  border:none;
  width:100%;
  height:800px;
  border-radius:8px;
  overflow:hidden;
}
.forms-wrap{
  position:relative;
  overflow:hidden;
  border:2px solid #002855;
  border-radius:8px;
}
.forms-wrap .mask-bottom{
  display:none;
}

/* üîπ Bot√£o flutuante fixo no canto inferior direito */
.btn-flutuante{
  position:fixed;
  bottom:30px;
  right:30px;
  background:var(--cor-primaria);
  color:white;
  border:none;
  padding:15px 25px;
  border-radius:50px;
  font-weight:bold;
  cursor:pointer;
  box-shadow:0 4px 10px rgba(0,0,0,0.25);
  transition:0.3s;
  z-index:999;
}
.btn-flutuante:hover{
  background:#003366;
}
</style>


</head>

<body>
<header class="main-header"><h1>Sistema de Gest√£o de Estoque - Bora Transportes</h1></header>

<!-- üè† TELA PRINCIPAL -->
<main id="tela-principal" class="screen active">
  <h2 class="sub-title">Selecione uma Op√ß√£o</h2>
  <div class="button-grid">
    <button id="btn-cadastro" class="main-button">Cadastro</button>
    <button id="btn-entrada" class="main-button">Entrada</button>
    <button id="btn-saida" class="main-button">Sa√≠da</button>
    <button id="btn-saldo" class="main-button">Saldo</button>
  </div>
</main>

<!-- üìã TELA CADASTRO -->
<div id="tela-cadastro" class="screen">
  <h2 class="sub-title">Cadastro de Produto</h2>
  <div class="forms-wrap">
    <iframe src="https://forms.office.com/Pages/ResponsePage.aspx?id=V2vtxCDuGECFbJBsQgFoSMHt4qeT3V1Djd4VrtFsitxURTRUMlpWNDQ2VTJJWUM0T05BTkVGRUdDRy4u&embed=true"></iframe>
    <div class="mask-bottom"></div>
  </div>
  <div class="form-actions"><button id="btn-voltar-cadastro" class="action-button secondary">Voltar</button></div>
</div>

<!-- üì¶ TELA ENTRADA -->
<div id="tela-entrada" class="screen">
  <h2 class="sub-title">Registro de Entrada</h2>
  <div class="forms-wrap">
    <iframe src="https://forms.microsoft.com/Pages/ResponsePage.aspx?id=V2vtxCDuGECFbJBsQgFoSMHt4qeT3V1Djd4VrtFsitxUODg1NjJLTEYzOFRaVjlGMFEwWDJVSEVWWi4u&embed=true"></iframe>
    <div class="mask-bottom"></div>
  </div>
  <div class="form-actions"><button id="btn-voltar-entrada" class="action-button secondary">Voltar</button></div>
</div>

<!-- üöö TELA SA√çDA -->
<div id="tela-saida" class="screen">
  <h2 class="sub-title">Registro de Sa√≠da</h2>
  <div class="forms-wrap">
    <iframe src="https://forms.microsoft.com/Pages/ResponsePage.aspx?id=V2vtxCDuGECFbJBsQgFoSMHt4qeT3V1Djd4VrtFsitxUMEg4TTdMVVJaUktJTlpPR1NCQjBITllISS4u&embed=true"></iframe>
    <div class="mask-bottom"></div>
  </div>
  <div class="form-actions"><button id="btn-voltar-saida" class="action-button secondary">Voltar</button></div>
</div>

<!-- üìä TELA SALDO -->
<div id="tela-saldo" class="screen">
  <h2 class="sub-title">Consulta de Saldo</h2>
  <div class="form-group">
    <label for="buscaProduto">Buscar por C√≥digo de F√°brica ou Descri√ß√£o:</label>
    <input type="text" id="buscaProduto" placeholder="Digite o c√≥digo ou descri√ß√£o do produto...">
  </div>
  <div class="data-display" id="resultado-saldo">
    üîç Nenhum produto selecionado.
  </div>
  <div class="form-actions"><button id="btn-voltar-saldo" class="action-button secondary">Voltar</button></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const telas = document.querySelectorAll(".screen");
  function mostrarTela(id){
    telas.forEach(t=>t.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    window.scrollTo(0,0);
  }
  document.getElementById("btn-cadastro").onclick=()=>mostrarTela("tela-cadastro");
  document.getElementById("btn-entrada").onclick=()=>mostrarTela("tela-entrada");
  document.getElementById("btn-saida").onclick=()=>mostrarTela("tela-saida");
  document.getElementById("btn-saldo").onclick=()=>mostrarTela("tela-saldo");
  document.getElementById("btn-voltar-cadastro").onclick=()=>mostrarTela("tela-principal");
  document.getElementById("btn-voltar-entrada").onclick=()=>mostrarTela("tela-principal");
  document.getElementById("btn-voltar-saida").onclick=()=>mostrarTela("tela-principal");
  document.getElementById("btn-voltar-saldo").onclick=()=>mostrarTela("tela-principal");

  // ======== CONSULTA DE SALDO ======== //
  const SP_SITE = "https://borexpress.sharepoint.com/sites/EstoqueJC";
  const inputBusca = document.getElementById("buscaProduto");
  const display = document.getElementById("resultado-saldo");

  inputBusca.addEventListener("input", async ()=>{
    const termo = inputBusca.value.trim();
    if(termo === ""){
      display.textContent = "üîç Nenhum produto selecionado.";
      return;
    }

    try {
      const produto = await buscarProduto(SP_SITE, termo);
      if(!produto){ display.textContent="‚ùå Produto n√£o encontrado."; return; }

      const entradas = await somarLista(SP_SITE, "Entrada", produto.Title);
      const saidas = await somarLista(SP_SITE, "Sa√≠das", produto.Title);
      const saldo = entradas - saidas;

      display.innerHTML = `
        <strong>Produto:</strong> ${produto.DescricaoProduto || "-"}<br>
        <strong>C√≥d. F√°brica:</strong> ${produto.Title}<br>
        <strong>Fornecedor:</strong> ${produto.CodigoFornecedor || "-"}<br>
        <strong>Saldo Atual:</strong> <span class="large-text">${saldo}</span> ${produto.UnidadeMedida || ""}
      `;
    } catch(e){
      display.textContent = "Erro ao buscar saldo.";
      console.error(e);
    }
  });

  async function buscarProduto(site, termo){
    const filter = `$filter=(Title eq '${termo}' or CodigoFornecedor eq '${termo}' or substringof('${termo}',DescricaoProduto))`;
    const url = `${site}/_api/web/lists/getbytitle('Produtos')/items?${filter}`;
    const r = await fetch(url,{headers:{"Accept":"application/json;odata=nometadata"},credentials:"include"});
    const d = await r.json();
    return d.value && d.value[0];
  }
  async function somarLista(site, lista, codFab){
    const url = `${site}/_api/web/lists/getbytitle('${lista}')/items?$filter=Title eq '${codFab}'`;
    const r = await fetch(url,{headers:{"Accept":"application/json;odata=nometadata"},credentials:"include"});
    const d = await r.json();
    return d.value ? d.value.reduce((acc,i)=>acc+Number(i.Quantidade||0),0) : 0;
  }
});
</script>
</body>
</html>


